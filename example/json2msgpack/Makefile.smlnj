HEAP_SUFFIX = x86-linux
SML_COMPILER = smlnj

json2msgpack.$(HEAP_SUFFIX): json2msgpack.sml
	ml-build json2msgpack.cm Main.main json2msgpack

json2msgpack.sml: json2msgpack.sml.in
	echo '(* DO NOT EDIT THIS FILE! *)' > $@
	m4 -DSML_COMPILER=$(SML_COMPILER) json2msgpack.sml.in >> $@

run: json2msgpack.$(HEAP_SUFFIX)
	sml @SMLload=$<

clean:
	rm -f json2msgpack.$(HEAP_SUFFIX) json2msgpack.sml
